{"version":3,"file":"hyperapp-render.min.js","sources":["src/index.js"],"sourcesContent":["const { isArray } = Array\nconst { hasOwnProperty } = Object.prototype\nconst styleNameCache = new Map()\nconst uppercasePattern = /[A-Z]/g\nconst msPattern = /^ms-/\n\n// https://www.w3.org/International/questions/qa-escapes#use\nconst escapeRegExp = /[\"&'<>]/\n\n// https://www.w3.org/TR/html/syntax.html#void-elements\nconst voidElements = new Set([\n  'area',\n  'base',\n  'br',\n  'col',\n  'embed',\n  'hr',\n  'img',\n  'input',\n  'link',\n  'meta',\n  'param',\n  'source',\n  'track',\n  'wbr',\n])\n\n// credits to https://github.com/component/escape-html\nexport function escapeHtml(value) {\n  const str = '' + value\n  if (typeof value === 'number') {\n    // better performance for safe values\n    return str\n  }\n\n  const match = escapeRegExp.exec(str)\n  if (!match) {\n    return str\n  }\n\n  let { index } = match\n  let lastIndex = 0\n  let out = ''\n\n  for (let escape = ''; index < str.length; index++) {\n    switch (str.charCodeAt(index)) {\n      case 34: // \"\n        escape = '&quot;'\n        break\n      case 38: // &\n        escape = '&amp;'\n        break\n      case 39: // '\n        escape = '&#39;' // shorter than \"&apos;\" and \"&#x27;\" plus supports HTML4\n        break\n      case 60: // <\n        escape = '&lt;'\n        break\n      case 62: // >\n        escape = '&gt;'\n        break\n      default:\n        continue\n    }\n\n    if (lastIndex !== index) {\n      out += str.substring(lastIndex, index)\n    }\n\n    lastIndex = index + 1\n    out += escape\n  }\n\n  return lastIndex !== index ? out + str.substring(lastIndex, index) : out\n}\n\n// credits to https://github.com/jorgebucaran/classcat\nexport function concatClassNames(value) {\n  if (typeof value === 'string' || typeof value === 'number') {\n    return value || ''\n  }\n\n  let out = ''\n  let delimiter = ''\n\n  if (isArray(value)) {\n    for (let i = 0; i < value.length; i++) {\n      const name = concatClassNames(value[i])\n      if (name !== '') {\n        out += delimiter + name\n        delimiter = ' '\n      }\n    }\n  } else {\n    for (const name in value) {\n      if (hasOwnProperty.call(value, name) && value[name]) {\n        out += delimiter + name\n        delimiter = ' '\n      }\n    }\n  }\n\n  return out\n}\n\n// \"backgroundColor\" => \"background-color\"\n// \"MozTransition\" => \"-moz-transition\"\n// \"msTransition\" => \"-ms-transition\"\nfunction hyphenateStyleName(styleName) {\n  if (!styleNameCache.has(styleName)) {\n    const name = styleName.replace(uppercasePattern, '-$&').toLowerCase().replace(msPattern, '-ms-')\n\n    // returns 'undefined' instead of the 'Map' object in IE11\n    styleNameCache.set(styleName, name)\n  }\n  return styleNameCache.get(styleName)\n}\n\nexport function stringifyStyles(style) {\n  let out = ''\n  let delimiter = ''\n\n  for (const name in style) {\n    if (hasOwnProperty.call(style, name)) {\n      const value = style[name]\n\n      if (value != null) {\n        if (name === 'cssText') {\n          out += delimiter + value\n        } else {\n          out += delimiter + hyphenateStyleName(name) + ':' + value\n        }\n        delimiter = ';'\n      }\n    }\n  }\n\n  return out\n}\n\n// https://www.w3.org/TR/html51/syntax.html#serializing-html-fragments\nfunction renderFragment(name, props, children, stack) {\n  let out = ''\n  let footer = ''\n\n  if (name) {\n    out += '<' + name\n\n    for (let prop in props) {\n      if (hasOwnProperty.call(props, prop)) {\n        let value = props[prop]\n\n        if (\n          value != null &&\n          prop !== 'key' &&\n          prop !== 'innerHTML' &&\n          prop !== '__source' && // babel-plugin-transform-react-jsx-source\n          !(prop[0] === 'o' && prop[1] === 'n')\n        ) {\n          if (prop === 'class' || prop === 'className') {\n            prop = 'class'\n            value = concatClassNames(value) || false\n          } else if (prop === 'style' && typeof value === 'object') {\n            value = stringifyStyles(value) || false\n          }\n\n          if (value !== false) {\n            out += ' ' + prop\n\n            if (value !== true) {\n              out += '=\"' + escapeHtml(value) + '\"'\n            }\n          }\n        }\n      }\n    }\n\n    if (voidElements.has(name)) {\n      out += '/>'\n    } else {\n      out += '>'\n      footer = '</' + name + '>'\n    }\n  }\n\n  if (children.length > 0) {\n    stack.push({\n      childIndex: 0,\n      children,\n      footer,\n    })\n  } else {\n    const { innerHTML } = props\n\n    if (innerHTML != null) {\n      out += innerHTML\n    }\n\n    out += footer\n  }\n\n  return out\n}\n\nfunction resolveNode(node, state, actions) {\n  if (typeof node === 'function') {\n    return resolveNode(node(state, actions), state, actions)\n  }\n  if (node && node.type === 2) {\n    return resolveNode(node.lazy.view(node.lazy), state, actions)\n  }\n  return node\n}\n\nexport function renderer(view, state, actions) {\n  const stack = [\n    {\n      childIndex: 0,\n      children: [view],\n      footer: '',\n    },\n  ]\n  let end = false\n\n  return (bytes) => {\n    if (end) {\n      return null\n    }\n\n    let out = ''\n\n    while (out.length < bytes) {\n      if (stack.length === 0) {\n        end = true\n        break\n      }\n\n      const frame = stack[stack.length - 1]\n\n      if (frame.childIndex >= frame.children.length) {\n        out += frame.footer\n        stack.pop()\n      } else {\n        const node = resolveNode(frame.children[frame.childIndex++], state, actions)\n\n        if (node != null && typeof node !== 'boolean') {\n          if (isArray(node)) {\n            stack.push({\n              childIndex: 0,\n              children: node,\n              footer: '',\n            })\n          } else if (node.tag === 3) {\n            out += escapeHtml(node.type)\n          } else if (node.type === 3) {\n            out += escapeHtml(node.name)\n          } else if (typeof node === 'object') {\n            out += renderFragment(\n              node.name || node.type || node.nodeName,\n              node.props || node.attributes,\n              node.children,\n              stack,\n            )\n          } else {\n            out += escapeHtml(node)\n          }\n        }\n      }\n    }\n\n    return out\n  }\n}\n\nexport function renderToString(view, state, actions) {\n  return renderer(view, state, actions)(Infinity)\n}\n"],"names":["isArray","Array","hasOwnProperty","Object","prototype","styleNameCache","Map","uppercasePattern","msPattern","escapeRegExp","voidElements","Set","escapeHtml","value","str","match","exec","index","lastIndex","out","escape","length","charCodeAt","substring","concatClassNames","delimiter","i","name","call","hyphenateStyleName","styleName","has","replace","toLowerCase","set","get","stringifyStyles","style","renderFragment","props","children","stack","footer","prop","push","childIndex","innerHTML","resolveNode","node","state","actions","type","lazy","view","end","bytes","frame","pop","tag","nodeName","attributes","renderer","Infinity"],"mappings":"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"}